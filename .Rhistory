priors_ <- priors
query_search_ <- query_search
ref_coldata_ <- ref_coldata
ref_column_names_ <- ref_column_names
ref_ontology_ <- ref_ontology
number_of_reference_cells_ <- number_of_reference_cells
number_of_labels_ <- number_of_labels
list_of_ref_cells_paths <- vector("list", length = number_of_reference_cells_)
vector_of_measured_index <- vector("numeric", length = number_of_reference_cells_)
current_index_in_list <- 0
i <- 1
ref_neighbors <- query_search_[['nn.idx']][i,]
nn_table <- ref_coldata_[ref_neighbors, ref_column_names_]
measured <- nn_table[1,]
nn_table <- nn_table[-1,]
devtools::install_github("jabiru/tictoc")
library(tictoc)
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels
) {
tic("main")
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=nrow(ref_ontology))
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:nrow(ref_ontology), function(j) {
path <- ref_ontology[j, ]
#Check if the path is present in the nn_table
is_present <- any(sapply(unique(nn_table), function(label) {label %in% path}))
if(!is_present) return(rep(0, number_of_labels))
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[colnames(nn_table)[h]]] == path[[colnames(path)[h]]]) / nrow(nn_table)
})
return(ratios)
})
toc()
return(ratio_of_paths)
}
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels
) {
tic("main")
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=nrow(ref_ontology))
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:nrow(ref_ontology), function(j) {
path <- ref_ontology[j, ]
#Check if the path is present in the nn_table
#is_present <- any(sapply(unique(nn_table), function(label) {label %in% path}))
#if(!is_present) return(rep(0, number_of_labels))
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[colnames(nn_table)[h]]] == path[[colnames(path)[h]]]) / nrow(nn_table)
})
return(ratios)
})
toc()
return(ratio_of_paths)
}
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels
) {
tic("main")
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=nrow(ref_ontology))
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:nrow(ref_ontology), function(j) {
path <- ref_ontology[j, ]
#Check if the path is present in the nn_table
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[colnames(nn_table)[h]]] == path[[colnames(path)[h]]]) / nrow(nn_table)
})
return(ratios)
})
toc()
return(ratio_of_paths)
}
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
number_of_reference_cells
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels
) {
tic("main")
#ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=nrow(ref_ontology))
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:nrow(ref_ontology), function(j) {
path <- ref_ontology[j, ]
#Check if the path is present in the nn_table
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[colnames(nn_table)[h]]] == path[[colnames(path)[h]]]) / nrow(nn_table)
})
return(ratios)
})
toc()
return(ratio_of_paths)
}
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels
) {
tic("main")
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=nrow(ref_ontology))
number_of_k_neighbors <- nrow(nn_table)
list_of_nn_table_colnames <- colnames(nn_table)
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:nrow(ref_ontology), function(j) {
path <- ref_ontology[j, ]
#Check if the path is present in the nn_table
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[list_of_nn_table_colnames[h]]] == path[[colnames(path)[h]]]) / number_of_k_neighbors
})
return(ratios)
})
toc()
return(ratio_of_paths)
}
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels
) {
tic("main")
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=nrow(ref_ontology))
number_of_k_neighbors <- nrow(nn_table)
list_of_nn_table_colnames <- colnames(nn_table)
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:nrow(ref_ontology), function(j) {
path <- ref_ontology[j, ]
#Check if the path is present in the nn_table
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[list_of_nn_table_colnames[h]]] == path[[colnames(path)[h]]]) / number_of_k_neighbors
})
return(ratios)
})
toc()
return(ratio_of_paths)
}
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels
) {
tic("main")
number_of_k_neighbors <- nrow(nn_table)
list_of_nn_table_colnames <- colnames(nn_table)
number_of_paths <- nrow(ref_ontology)
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=number_of_paths)
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:number_of_paths, function(j) {
path <- ref_ontology[j, ]
#Check if the path is present in the nn_table
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[list_of_nn_table_colnames[h]]] == path[[colnames(path)[h]]]) / number_of_k_neighbors
})
return(ratios)
})
toc()
return(ratio_of_paths)
}
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels)
measured
measured_index <- which(apply(ref_ontology_, 1, function(row) all(row == measured)))
tic()
measured_index <- which(apply(ref_ontology_, 1, function(row) all(row == measured)))
toc()
tic(); toc()
tic(); measured_index <- which(apply(ref_ontology_, 1, function(row) all(row == measured))); toc()
list(ratio_of_paths, measured_index)
z <- list(ratio_of_paths, measured_index)
z
z[[1]]
z[[2]]
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels,
measured = NULL
) {
list_of_nn_table_colnames <- colnames(nn_table)
number_of_paths <- nrow(ref_ontology)
number_of_k_neighbors <- nrow(nn_table)
measured_index <- 0
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=number_of_paths)
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:number_of_paths, function(j) {
path <- ref_ontology[j, ]
if(!is.null(measured) && all(measured == path))  measured_index <- j
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[list_of_nn_table_colnames[h]]] == path[[colnames(path)[h]]]) / number_of_k_neighbors
})
return(ratios)
})
return(list(ratio_of_paths, measured_index))
}
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels,
measured = NULL
) {
list_of_nn_table_colnames <- colnames(nn_table)
number_of_paths <- nrow(ref_ontology)
number_of_k_neighbors <- nrow(nn_table)
measured_index <- 0
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=number_of_paths)
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:number_of_paths, function(j) {
path <- ref_ontology[j, ]
if(!is.null(measured) & all(measured == path))  measured_index <- j
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[list_of_nn_table_colnames[h]]] == path[[colnames(path)[h]]]) / number_of_k_neighbors
})
return(ratios)
})
return(list(ratio_of_paths, measured_index))
}
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels,
measured = NULL
) {
list_of_nn_table_colnames <- colnames(nn_table)
number_of_paths <- nrow(ref_ontology)
number_of_k_neighbors <- nrow(nn_table)
measured_index <- 0
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=number_of_paths)
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:number_of_paths, function(j) {
path <- ref_ontology[j, ]
if(!is.null(measured) && all(measured == path))  measured_index <- j
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[list_of_nn_table_colnames[h]]] == path[[colnames(path)[h]]]) / number_of_k_neighbors
})
return(ratios)
})
return(list(ratio_of_paths, measured_index))
}
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels,
measured = NULL
) {
list_of_nn_table_colnames <- colnames(nn_table)
number_of_paths <- nrow(ref_ontology)
number_of_k_neighbors <- nrow(nn_table)
measured_index <- 0
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=number_of_paths)
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:number_of_paths, function(j) {
path <- ref_ontology[j, ]
if(!is.null(measured) & all(measured == path))  measured_index <- j
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[list_of_nn_table_colnames[h]]] == path[[colnames(path)[h]]]) / number_of_k_neighbors
})
return(ratios)
})
return(list(ratio_of_paths, measured_index))
}
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labelsnn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels
) {
list_of_nn_table_colnames <- colnames(nn_table)
number_of_paths <- nrow(ref_ontology)
number_of_k_neighbors <- nrow(nn_table)
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=number_of_paths)
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:number_of_paths, function(j) {
path <- ref_ontology[j, ]
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[list_of_nn_table_colnames[h]]] == path[[colnames(path)[h]]]) / number_of_k_neighbors
})
return(ratios)
})
return(ratio_of_paths)
}); toc()
nn_table_to_matrix <- function(
ref_ontology,
nn_table,
number_of_labels
) {
list_of_nn_table_colnames <- colnames(nn_table)
number_of_paths <- nrow(ref_ontology)
number_of_k_neighbors <- nrow(nn_table)
ratio_of_paths <- matrix(0, nrow=number_of_labels, ncol=number_of_paths)
#This chunk will calculate the ratio of paths for unique label in cds_ref
ratio_of_paths <- sapply(1:number_of_paths, function(j) {
path <- ref_ontology[j, ]
ratios <- sapply(1:number_of_labels, function(h) {
sum(nn_table[[list_of_nn_table_colnames[h]]] == path[[colnames(path)[h]]]) / number_of_k_neighbors
})
return(ratios)
})
return(ratio_of_paths)
}
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
tic(); ratio_of_paths <- nn_table_to_matrix(ref_ontology, nn_table, number_of_labels); toc()
source("~/Desktop/sclass_local/temp.R")
tic(); a(ref_ontology_, nn_table, number_of_labels = number_of_labels) toc();
tic(); a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
source("~/Desktop/sclass_local/temp.R")
tic(); a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- a(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
tic(); x <- b(ref_ontology_, nn_table, number_of_labels = number_of_labels); toc();
source('load_data.R')
L()
plot_cells(cds_ref, color_cells_by = cell_type_sub)
colData(cds_ref)
plot_cells(cds_ref, color_cells_by = "cell_type_sub")
plot_cells(cds_ref, color_cells_by = "cell_type_sub")
plot_cells(cds_ref, color_cells_by = "cell_type_sub")
source('load_data.R')
VD()
LD()
VD()
ref_coldata <- as.data.frame(colData(cds_ref))
nn_control_default <- list(method='annoy', metric='euclidean', n_trees=50, M=48, ef_construction=200, ef=150, grain_size=1, cores=1)
nn_control_tmp <- set_nn_control(mode=2,
nn_control=nn_control,
nn_control_default=nn_control_default,
nn_index=NULL,
k=k,
verbose=verbose)
cds_ref_temp <- cds_ref
cds_query_temp <- cds_query
colData(cds_ref_temp)[['data_set']] <- 'reference'
colData(cds_query_temp)[['data_set']] <- 'query'
cds_com <- combine_cds(list(cds_ref_temp, cds_query_temp), keep_all_genes=TRUE, cell_names_unique=TRUE, keep_reduced_dims=TRUE)
cds_com <- combine_cds(list(cds_ref_temp, cds_query_temp), keep_all_genes=TRUE, cell_names_unique=FALSE, keep_reduced_dims=TRUE)
cds_com <- load_transform_models(cds_com, directory_path=transform_models_dir)
cds_com <- preprocess_cds(cds_com)
source('load_data.R')
LD()
VD()
cds_nn <- data.frame(matrix(NA, nrow=NUMBER_OF_QUERY_CELLS, ncol=NUMBER_OF_LABELS))
ref_coldata <- as.data.frame(colData(cds_ref))
nn_control_default <- list(method='annoy', metric='euclidean', n_trees=50, M=48, ef_construction=200, ef=150, grain_size=1, cores=1)
nn_control_tmp <- set_nn_control(mode=2,
nn_control=nn_control,
nn_control_default=nn_control_default,
nn_index=NULL,
k=k,
verbose=verbose)
cds_ref_temp <- cds_ref
cds_query_temp <- cds_query
colData(cds_ref_temp)[['data_set']] <- 'reference'
colData(cds_query_temp)[['data_set']] <- 'query'
cds_com <- combine_cds(list(cds_ref_temp, cds_query_temp), keep_reduced_dims = TRUE)
cds_com <- load_transform_models(cds_com, directory_path=transform_models_dir)
cds_com <- preprocess_cds(cds_com)
unique(colnames(colData(cds_com)))
plot_cells(cds_com, color_cells_by = "Cell.type.annotation")
learn_graph(cds_com)
plot_cells(cds_com, color_cells_by = "data_set")
colData(cds_com)$data_set
any(is.any(colData(cds_com)$data_set))
any(is.na(colData(cds_com)$data_set))
plot_cells(cds_com, color_cells_by = "data_set")
plot_cells(cds_com, color_cells_by = "data_set")
plot_cells(cds_com, color_cells_by = "Cell.type.annotation")
q
q
q
q
source('load_data.R')
LD()
VD()
cds_com <- combine_cds(list(cds_ref, cds_query), keep_reduced_dims = TRUE)
cds_com <- load_transform_models(cds_com, directory_path=transform_models_dir)
cds_com <- preprocess_cds(cds_com)
plot_cells_3d(cds_com)
cds_3d <- reduce_dimension(cds_com, max_components = 3)
cds_3d <- cluster_cells(cds_3d)
cds_3d <- plot_cells_3d(cds_com)
source('load_data')
source('load_data.R')
LD()
cds_ref <- reduce_dimension(cds_ref, umap.min_dist = 0.25, umap.n_neighbors = 200)
plot_cells(cds_ref)
dim(cds_ref)
length(rownames(colData(cds_ref)))
rownames(cds_ref) <- 1:116731
rownames(colData(cds_ref)) <- 1:116731
plot_cells(cds_ref, color_cells_by = "Cell.type.annotation")
plot_cells(cds_ref, color_cells_by = "Cell.type.annotation")
cds_ref <- cds_ref[, !(colData(cds_ref)$Cell.type.annotation %in% c('T', 'Prog', 'Undifferentiated'))]
cds_ref <- reduce_dimension(cds_ref, umap.min_dist = 0.25, umap.n_neighbors = 200)
plot_cells(cds_ref, color_cells_by = "Cell.type.annotation")
